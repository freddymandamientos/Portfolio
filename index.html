<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Gantt Mantenimientos 2026 – EGESUR</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:Segoe UI,Arial;background:#0b1220;color:#e5e7eb}
header{padding:16px 20px;border-bottom:1px solid #24324f}
h1{margin:0;font-size:18px}
.filters{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
select{background:#0f1a33;color:#fff;border:1px solid #24324f;padding:8px 10px;border-radius:8px}
.container{padding:16px 20px}
.legend{display:flex;gap:12px;margin-bottom:12px}
.legend span{display:flex;align-items:center;gap:6px;font-size:13px}
.dot{width:10px;height:10px;border-radius:50%}
.card{background:#0f1a33;border:1px solid #24324f;border-radius:14px;overflow:hidden}
.headerRow,.row{display:grid;grid-template-columns:300px 1fr}
.headerRow div{padding:10px 12px;border-bottom:1px solid #24324f;font-weight:600}
.left{padding:8px 12px;border-bottom:1px solid #1f2a44}
.right{position:relative;height:42px;border-bottom:1px solid #1f2a44}
.bar{position:absolute;top:9px;height:24px;border-radius:10px;cursor:pointer}
.bar:hover{filter:brightness(1.15)}
.tooltip{
position:fixed;display:none;background:#020617;color:#e5e7eb;
border:1px solid #24324f;padding:10px 12px;border-radius:10px;
font-size:12px;max-width:380px;z-index:999
}
.footer{padding:8px 12px;font-size:12px;color:#94a3b8;border-top:1px solid #24324f}
</style>
</head>

<body>
<header>
<h1>Diagrama de Gantt – Mantenimientos 2026 (EGESUR)</h1>
<div class="filters">
<select id="fUbicacion"></select>
<select id="fEquipo"></select>
<select id="fTipo"></select>
</div>
</header>

<div class="container">
<div class="legend">
<span><div class="dot" style="background:#3b82f6"></div>Mantenimiento Preventivo</span>
<span><div class="dot" style="background:#22c55e"></div>Pruebas</span>
<span><div class="dot" style="background:#f59e0b"></div>Otros</span>
</div>

<div class="card">
<div class="headerRow">
<div>Ubicación – Equipo</div>
<div>Cronograma</div>
</div>
<div id="rows"></div>
<div class="footer" id="footer"></div>
</div>
</div>

<div class="tooltip" id="tip"></div>

<script>
// ================= DATOS =================
const data = [
{u:"ARICOTA I",e:"G1",i:"08/01/2026 06:30",f:"08/01/2026 13:30",t:"MANTENIMIENTO PREVENTIVO",d:"MANTENIMIENTO ELECTROMECÁNICO 1"},
{u:"ARICOTA I",e:"G1",i:"09/04/2026 00:00",f:"29/04/2026 00:00",t:"MANTENIMIENTO PREVENTIVO",d:"MEC 3 / MODERNIZACIÓN AVR SISTEMA DE EXCITACIÓN"},
{u:"ARICOTA I",e:"G2",i:"30/04/2026 00:00",f:"20/05/2026 00:00",t:"MANTENIMIENTO PREVENTIVO",d:"MEC 3 / MODERNIZACIÓN AVR SISTEMA DE EXCITACIÓN"},
{u:"ARICOTA II",e:"G1",i:"22/05/2026 00:00",f:"11/06/2026 00:00",t:"MANTENIMIENTO PREVENTIVO",d:"MEC 3 / MODERNIZACIÓN AVR SISTEMA DE EXCITACIÓN"},
{u:"INDEPENDENCIA",e:"INDEP_G1",i:"22/02/2026 05:00",f:"22/02/2026 17:00",t:"OTROS",d:"Patio de llaves y SSAA"},
{u:"INDEPENDENCIA",e:"INDEP_G1",i:"15/07/2026 04:00",f:"19/07/2026 00:00",t:"MANTENIMIENTO PREVENTIVO",d:"Mantenimiento 4,000 horas"},
{u:"INDEPENDENCIA",e:"INDEP_G1",i:"15/07/2026 04:00",f:"15/07/2026 08:00",t:"PRUEBAS",d:"Pruebas deflexión cigüeñal"},
];

// ================= CONFIG =================
const colors={
"MANTENIMIENTO PREVENTIVO":"#3b82f6",
"PRUEBAS":"#22c55e",
"OTROS":"#f59e0b"
};

const tip=document.getElementById("tip");

// ================= FUNCIONES =================
const parse=s=>{
const [d,t]=s.split(" ");
const [dd,mm,yy]=d.split("/");
const [hh,mi]=t.split(":");
return new Date(yy,mm-1,dd,hh,mi);
};

const fmt=d=>{
const p=n=>String(n).padStart(2,"0");
return `${p(d.getDate())}/${p(d.getMonth()+1)}/${d.getFullYear()} ${p(d.getHours())}:${p(d.getMinutes())}`;
};

// ================= RENDER =================
function render(){
const rows=document.getElementById("rows");
rows.innerHTML="";

const ext=data.map(x=>({...x,di:parse(x.i),df:parse(x.f)}));
const min=new Date(Math.min(...ext.map(x=>x.di)));
const max=new Date(Math.max(...ext.map(x=>x.df)));
const total=max-min;

const groups={};
ext.forEach(x=>{
const k=`${x.u} – ${x.e}`;
(groups[k]??=[]).push(x);
});

let count=0;

Object.keys(groups).sort().forEach(k=>{
const left=document.createElement("div");
left.className="left";
left.textContent=k;

const right=document.createElement("div");
right.className="right";

groups[k].forEach(ev=>{
const b=document.createElement("div");
const l=((ev.di-min)/total)*100;
const w=((ev.df-ev.di)/total)*100;
b.className="bar";
b.style.left=l+"%";
b.style.width=Math.max(w,0.5)+"%";
b.style.background=colors[ev.t]||"#94a3b8";

const dur=((ev.df-ev.di)/36e5).toFixed(1);

b.onmousemove=e=>{
tip.style.display="block";
tip.style.left=e.clientX+12+"px";
tip.style.top=e.clientY+12+"px";
tip.innerHTML=`<b>${k}</b><br>${ev.t}<br>Inicio: ${fmt(ev.di)}<br>Fin: ${fmt(ev.df)}<br>Duración: ${dur} h<br>${ev.d}`;
};
b.onmouseleave=()=>tip.style.display="none";

right.appendChild(b);
count++;
});

rows.appendChild(left);
rows.appendChild(right);
});

document.getElementById("footer").textContent=
`Eventos: ${ext.length} | Barras: ${count} | Rango: ${fmt(min)} → ${fmt(max)}`;
}

render();
</script>
</body>
</html>
